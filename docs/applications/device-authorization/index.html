<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Device Authorization (CLI) â€” Vouch â€” Hardware-Backed Developer Credentials</title>
<meta name=description content="Integrate Vouch authentication into native desktop applications and CLI tools using the Device Authorization Grant."><link rel=canonical href=https://vouch.sh/docs/applications/device-authorization/><meta property="og:title" content="Device Authorization (CLI) â€” Vouch â€” Hardware-Backed Developer Credentials"><meta property="og:description" content="Integrate Vouch authentication into native desktop applications and CLI tools using the Device Authorization Grant."><meta property="og:url" content="https://vouch.sh/docs/applications/device-authorization/"><meta property="og:site_name" content="Vouch"><meta property="og:type" content="article"><meta property="og:image" content="https://vouch.sh/img/og-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Device Authorization (CLI) â€” Vouch â€” Hardware-Backed Developer Credentials"><meta name=twitter:description content="Integrate Vouch authentication into native desktop applications and CLI tools using the Device Authorization Grant."><meta name=twitter:image content="https://vouch.sh/img/og-image.png"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”‘</text></svg>"><link rel=author href=/humans.txt><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","description":"Open-source credential broker that issues short-lived SSH, AWS, GitHub, and Kubernetes credentials after FIDO2 hardware verification. One YubiKey tap, 8 hours of access.","name":"Vouch","url":"https://vouch.sh/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","logo":"https://vouch.sh/img/og-image.png","name":"Smoke Turner, LLC","sameAs":["https://github.com/vouch-sh/vouch"],"url":"https://smoketurner.com"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"TechArticle","author":{"@type":"Organization","name":"Smoke Turner, LLC"},"description":"Integrate Vouch authentication into native desktop applications and CLI tools using the Device Authorization Grant.","headline":"Device Authorization (CLI)","mainEntityOfPage":{"@id":"https://vouch.sh/docs/applications/device-authorization/","@type":"WebPage"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://vouch.sh/img/og-image.png"},"name":"Smoke Turner, LLC"}}</script><link rel=stylesheet href=https://vouch.sh/css/main.min.696319dec26a9f9526ac8dae8c8e12c4271af4250b998632e1aca67447bb363d.css></head><body><header class=nav><div class=nav-inner><a href=/ class=nav-logo><svg viewBox="0 0 32 32" fill="none"><rect x="9" y="14" width="14" height="12" rx="2" stroke="currentcolor" stroke-width="2"/><path d="M12 14V10a4 4 0 118 0v4" stroke="currentcolor" stroke-width="2" stroke-linecap="round"/><circle cx="16" cy="20" r="1.5" fill="currentcolor"/><line x1="16" y1="21.5" x2="16" y2="23.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/></svg>
vouch
</a><button class=nav-toggle aria-label="Toggle navigation" onclick='document.querySelector(".nav-links").classList.toggle("open")'><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><ul class=nav-links><li><a href=/docs/>Docs</a></li><li><a href=/blog/>Blog</a></li><li><a href=/about/>About</a></li><li><a href=https://github.com/vouch-sh/vouch target=_blank rel=noopener>GitHub<svg class="github-icon" viewBox="0 0 24 24" fill="currentcolor"><path d="M12 0C5.37.0.0 5.37.0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57.0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925.0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18.0.0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225.0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22.0 1.605-.015 2.895-.015 3.3.0.315.225.69.825.57A12.02 12.02.0 0024 12c0-6.63-5.37-12-12-12z"/></svg></a></li></ul></div></header><main class=content-wrapper><div class=docs-layout><aside class=docs-sidebar id=docs-sidebar><div class=docs-sidebar-title>Documentation</div><nav><ul><li><a href=https://vouch.sh/docs/getting-started/>Getting Started</a></li><li><a href=https://vouch.sh/docs/startups/>Startups</a></li><li class=sidebar-section-group><span class=sidebar-section-label>Infrastructure</span><ul><li><a href=https://vouch.sh/docs/aws/>AWS</a></li><li><a href=https://vouch.sh/docs/aws-multi-account/>AWS Multi-Account</a></li><li><a href=https://vouch.sh/docs/ssh/>SSH Certificates</a></li><li><a href=https://vouch.sh/docs/eks/>Amazon EKS</a></li><li><a href=https://vouch.sh/docs/ssm/>AWS Systems Manager</a></li><li><a href=https://vouch.sh/docs/databases/>Databases</a></li><li><a href=https://vouch.sh/docs/bedrock/>Amazon Bedrock</a></li></ul></li><li class=sidebar-section-group><span class=sidebar-section-label>Code & Packages</span><ul><li><a href=https://vouch.sh/docs/github/>GitHub</a></li><li><a href=https://vouch.sh/docs/docker/>Docker Registries</a></li><li><a href=https://vouch.sh/docs/codeartifact/>AWS CodeArtifact</a></li><li><a href=https://vouch.sh/docs/codecommit/>AWS CodeCommit</a></li><li><a href=https://vouch.sh/docs/cargo/>Cargo</a></li></ul></li><li class=sidebar-section-group><span class=sidebar-section-label>Platform</span><ul><li class="sidebar-group open"><div class=sidebar-group-header><a href=https://vouch.sh/docs/applications/>Applications (OIDC)
</a><button class=sidebar-chevron onclick='this.closest(".sidebar-group").classList.toggle("open")' aria-label="Toggle section"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></button></div><ul class=sidebar-children><li><a href=https://vouch.sh/docs/applications/rails/>Rails (OmniAuth)</a></li><li><a href=https://vouch.sh/docs/applications/django/>Django (django-allauth)</a></li><li><a href=https://vouch.sh/docs/applications/express/>Express.js (Passport)</a></li><li><a href=https://vouch.sh/docs/applications/nextjs/>Next.js (NextAuth.js)</a></li><li><a href=https://vouch.sh/docs/applications/laravel/>Laravel (Socialite)</a></li><li><a href=https://vouch.sh/docs/applications/flask/>Flask (Authlib)</a></li><li><a href=https://vouch.sh/docs/applications/fastapi/>FastAPI (Authlib)</a></li><li><a href=https://vouch.sh/docs/applications/spring-boot/>Spring Boot (Spring Security)</a></li><li><a href=https://vouch.sh/docs/applications/axum/>Axum (openidconnect-rs)</a></li><li><a href=https://vouch.sh/docs/applications/react/>React (react-oidc-context)</a></li><li><a href=https://vouch.sh/docs/applications/vue/>Vue (oidc-client-ts)</a></li><li><a href=https://vouch.sh/docs/applications/vanilla-js/>Vanilla JavaScript</a></li><li><a href=https://vouch.sh/docs/applications/device-authorization/ class=active>Device Authorization (CLI)</a></li></ul></li><li><a href=https://vouch.sh/docs/scim/>SCIM Provisioning</a></li><li><a href=https://vouch.sh/docs/iac/>Infrastructure as Code</a></li><li><a href=https://vouch.sh/docs/cicd/>CI/CD</a></li><li><a href=https://vouch.sh/docs/cli-reference/>CLI Reference</a></li><li><a href=https://vouch.sh/docs/security/>Security</a></li><li><a href=https://vouch.sh/docs/threat-model/>Threat Model</a></li><li><a href=https://vouch.sh/docs/architecture/>Architecture</a></li><li><a href=https://vouch.sh/docs/availability/>Availability</a></li><li><a href=https://vouch.sh/docs/migration/>Migration</a></li><li><a href=https://vouch.sh/docs/faq/>FAQ</a></li></ul></li></ul></nav></aside><article class=docs-content><div class=docs-breadcrumb><a href=https://vouch.sh/docs/>Docs</a><span class=separator>/</span><a href=https://vouch.sh/docs/applications/>Add Hardware-Backed Sign-In to Your Application</a><span class=separator>/</span>
Device Authorization (CLI)</div><h1>Device Authorization (CLI)</h1><blockquote><p>See the <a href=https://vouch.sh/docs/applications/>Applications overview</a> for prerequisites, configuration endpoints, and available scopes.</p></blockquote><p>For native desktop applications and CLI tools that cannot open a browser redirect, use the <strong>Device Authorization Grant</strong> (<a href=https://datatracker.ietf.org/doc/html/rfc8628>RFC 8628</a>). This flow displays a URL and code that the user enters in a browser on any device.</p><h2 id=device-authorization-flow>Device Authorization Flow</h2><ol><li>Your application requests a device code from the Vouch server.</li><li>The server returns a <code>device_code</code>, a <code>user_code</code>, and a <code>verification_uri</code>.</li><li>Your application displays the <code>user_code</code> and <code>verification_uri</code> to the user.</li><li>The user opens <code>verification_uri</code> in a browser, enters the code, and authenticates with their YubiKey.</li><li>Your application polls the token endpoint until the user completes authentication.</li><li>Once approved, the token endpoint returns an access token and ID token.</li></ol><h2 id=python>Python</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>VOUCH_URL <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://us.vouch.sh&#34;</span>
</span></span><span style=display:flex><span>CLIENT_ID <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#34;VOUCH_CLIENT_ID&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 1: Request device code</span>
</span></span><span style=display:flex><span>device_response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>VOUCH_URL<span style=color:#e6db74>}</span><span style=color:#e6db74>/oauth/device/code&#34;</span>,
</span></span><span style=display:flex><span>    data<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;client_id&#34;</span>: CLIENT_ID,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;scope&#34;</span>: <span style=color:#e6db74>&#34;openid email&#34;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>device_data <span style=color:#f92672>=</span> device_response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>device_code <span style=color:#f92672>=</span> device_data[<span style=color:#e6db74>&#34;device_code&#34;</span>]
</span></span><span style=display:flex><span>user_code <span style=color:#f92672>=</span> device_data[<span style=color:#e6db74>&#34;user_code&#34;</span>]
</span></span><span style=display:flex><span>verification_uri <span style=color:#f92672>=</span> device_data[<span style=color:#e6db74>&#34;verification_uri&#34;</span>]
</span></span><span style=display:flex><span>interval <span style=color:#f92672>=</span> device_data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;interval&#34;</span>, <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>expires_in <span style=color:#f92672>=</span> device_data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;expires_in&#34;</span>, <span style=color:#ae81ff>600</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 2: Display instructions to the user</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>To sign in, open this URL in your browser:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;  </span><span style=color:#e6db74>{</span>verification_uri<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;And enter the code: </span><span style=color:#e6db74>{</span>user_code<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Waiting for authentication...&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 3: Poll for the token</span>
</span></span><span style=display:flex><span>deadline <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>time() <span style=color:#f92672>+</span> expires_in
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> time<span style=color:#f92672>.</span>time() <span style=color:#f92672>&lt;</span> deadline:
</span></span><span style=display:flex><span>    time<span style=color:#f92672>.</span>sleep(interval)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    token_response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>VOUCH_URL<span style=color:#e6db74>}</span><span style=color:#e6db74>/oauth/token&#34;</span>,
</span></span><span style=display:flex><span>        data<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;grant_type&#34;</span>: <span style=color:#e6db74>&#34;urn:ietf:params:oauth:grant-type:device_code&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;device_code&#34;</span>: device_code,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;client_id&#34;</span>: CLIENT_ID,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> token_response<span style=color:#f92672>.</span>status_code <span style=color:#f92672>==</span> <span style=color:#ae81ff>200</span>:
</span></span><span style=display:flex><span>        tokens <span style=color:#f92672>=</span> token_response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Authenticated successfully!&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Access token: </span><span style=color:#e6db74>{</span>tokens[<span style=color:#e6db74>&#39;access_token&#39;</span>][:<span style=color:#ae81ff>20</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>...&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Fetch user info</span>
</span></span><span style=display:flex><span>        userinfo <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>VOUCH_URL<span style=color:#e6db74>}</span><span style=color:#e6db74>/oauth/userinfo&#34;</span>,
</span></span><span style=display:flex><span>            headers<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;Authorization&#34;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Bearer </span><span style=color:#e6db74>{</span>tokens[<span style=color:#e6db74>&#39;access_token&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>},
</span></span><span style=display:flex><span>        )<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Hello, </span><span style=color:#e6db74>{</span>userinfo<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#e6db74>&#39;user&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>!&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    error_data <span style=color:#f92672>=</span> token_response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>    error <span style=color:#f92672>=</span> error_data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;error&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> error <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;authorization_pending&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> error <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;slow_down&#34;</span>:
</span></span><span style=display:flex><span>        interval <span style=color:#f92672>+=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> error <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;expired_token&#34;</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;The device code has expired. Please try again.&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> error <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;access_denied&#34;</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Authentication was denied.&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Unexpected error: </span><span style=color:#e6db74>{</span>error<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Timed out waiting for authentication.&#34;</span>)
</span></span></code></pre></div><h2 id=nodejs>Node.js</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>https</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;https&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>querystring</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;querystring&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>VOUCH_URL</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://us.vouch.sh&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CLIENT_ID</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>VOUCH_CLIENT_ID</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>post</span>(<span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>VOUCH_URL</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>querystring</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>req</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>request</span>(
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>url</span>,
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/x-www-form-urlencoded&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;Content-Length&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>byteLength</span>(<span style=color:#a6e22e>body</span>),
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;data&#34;</span>, (<span style=color:#a6e22e>chunk</span>) =&gt; (<span style=color:#a6e22e>data</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>chunk</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;end&#34;</span>, () =&gt;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>resolve</span>({ <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>statusCode</span>, <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>data</span>) })
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;error&#34;</span>, <span style=color:#a6e22e>reject</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>write</span>(<span style=color:#a6e22e>body</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>end</span>();
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>token</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>VOUCH_URL</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>req</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>request</span>(
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>url</span>,
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;GET&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>Authorization</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`Bearer </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>token</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span> },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;data&#34;</span>, (<span style=color:#a6e22e>chunk</span>) =&gt; (<span style=color:#a6e22e>data</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>chunk</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;end&#34;</span>, () =&gt; <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>data</span>)));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#34;error&#34;</span>, <span style=color:#a6e22e>reject</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>end</span>();
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Step 1: Request device code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>deviceResponse</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/oauth/device/code&#34;</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client_id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>CLIENT_ID</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>scope</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;openid email&#34;</span>,
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>device_code</span>, <span style=color:#a6e22e>user_code</span>, <span style=color:#a6e22e>verification_uri</span>, <span style=color:#a6e22e>interval</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>, <span style=color:#a6e22e>expires_in</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>600</span> } <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>deviceResponse</span>.<span style=color:#a6e22e>body</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Step 2: Display instructions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`\nTo sign in, open this URL in your browser:\n`</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`  </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>verification_uri</span><span style=color:#e6db74>}</span><span style=color:#e6db74>\n`</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`And enter the code: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>user_code</span><span style=color:#e6db74>}</span><span style=color:#e6db74>\n`</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Waiting for authentication...&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Step 3: Poll for the token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pollInterval</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>interval</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>deadline</span> <span style=color:#f92672>=</span> Date.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>+</span> <span style=color:#a6e22e>expires_in</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>while</span> (Date.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>deadline</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>r</span>) =&gt; <span style=color:#a6e22e>setTimeout</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>pollInterval</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tokenResponse</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/oauth/token&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>grant_type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;urn:ietf:params:oauth:grant-type:device_code&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>device_code</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>client_id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>CLIENT_ID</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>tokenResponse</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;\nAuthenticated successfully!&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userinfo</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/oauth/userinfo&#34;</span>, <span style=color:#a6e22e>tokenResponse</span>.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>access_token</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Hello, </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>userinfo</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;user&#34;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>!`</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>error</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tokenResponse</span>.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;authorization_pending&#34;</span>) <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;slow_down&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pollInterval</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;expired_token&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;The device code has expired. Please try again.&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;access_denied&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Authentication was denied.&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Unexpected error: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>error</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Timed out waiting for authentication.&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>main</span>().<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>);
</span></span></code></pre></div><h2 id=rust>Rust</h2><p>Add the required dependencies to your <code>Cargo.toml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>dependencies</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>reqwest</span> = { <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.12&#34;</span>, <span style=color:#a6e22e>features</span> = [<span style=color:#e6db74>&#34;json&#34;</span>] }
</span></span><span style=display:flex><span><span style=color:#a6e22e>serde</span> = { <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;1&#34;</span>, <span style=color:#a6e22e>features</span> = [<span style=color:#e6db74>&#34;derive&#34;</span>] }
</span></span><span style=display:flex><span><span style=color:#a6e22e>serde_json</span> = <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tokio</span> = { <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;1&#34;</span>, <span style=color:#a6e22e>features</span> = [<span style=color:#e6db74>&#34;full&#34;</span>] }
</span></span></code></pre></div><p>Implement the device authorization flow:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> serde::Deserialize;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::env;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::time::{Duration, Instant};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(Deserialize)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>DeviceCodeResponse</span> {
</span></span><span style=display:flex><span>    device_code: String,
</span></span><span style=display:flex><span>    user_code: String,
</span></span><span style=display:flex><span>    verification_uri: String,
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[serde(default = </span><span style=color:#e6db74>&#34;default_interval&#34;</span><span style=color:#75715e>)]</span>
</span></span><span style=display:flex><span>    interval: <span style=color:#66d9ef>u64</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[serde(default = </span><span style=color:#e6db74>&#34;default_expires_in&#34;</span><span style=color:#75715e>)]</span>
</span></span><span style=display:flex><span>    expires_in: <span style=color:#66d9ef>u64</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>default_interval</span>() -&gt; <span style=color:#66d9ef>u64</span> { <span style=color:#ae81ff>5</span> }
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>default_expires_in</span>() -&gt; <span style=color:#66d9ef>u64</span> { <span style=color:#ae81ff>600</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(Deserialize)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>TokenResponse</span> {
</span></span><span style=display:flex><span>    access_token: String,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(Deserialize)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ErrorResponse</span> {
</span></span><span style=display:flex><span>    error: String,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(Deserialize)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>UserInfo</span> {
</span></span><span style=display:flex><span>    name: Option<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>    email: Option<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[tokio::main]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() -&gt; Result<span style=color:#f92672>&lt;</span>(), Box<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>dyn</span> std::error::Error<span style=color:#f92672>&gt;&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> vouch_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://us.vouch.sh&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> client_id <span style=color:#f92672>=</span> env::var(<span style=color:#e6db74>&#34;VOUCH_CLIENT_ID&#34;</span>)
</span></span><span style=display:flex><span>        .expect(<span style=color:#e6db74>&#34;VOUCH_CLIENT_ID environment variable not set&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> client <span style=color:#f92672>=</span> reqwest::Client::new();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Step 1: Request device code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> device_response: <span style=color:#a6e22e>DeviceCodeResponse</span> <span style=color:#f92672>=</span> client
</span></span><span style=display:flex><span>        .post(format!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{vouch_url}</span><span style=color:#e6db74>/oauth/device/code&#34;</span>))
</span></span><span style=display:flex><span>        .form(<span style=color:#f92672>&amp;</span>[
</span></span><span style=display:flex><span>            (<span style=color:#e6db74>&#34;client_id&#34;</span>, client_id.as_str()),
</span></span><span style=display:flex><span>            (<span style=color:#e6db74>&#34;scope&#34;</span>, <span style=color:#e6db74>&#34;openid email&#34;</span>),
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>        .send()
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>        .json()
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Step 2: Display instructions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    println!(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>To sign in, open this URL in your browser:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;  </span><span style=color:#e6db74>{}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, device_response.verification_uri);
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;And enter the code: </span><span style=color:#e6db74>{}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, device_response.user_code);
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;Waiting for authentication...&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Step 3: Poll for the token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> interval <span style=color:#f92672>=</span> Duration::from_secs(device_response.interval);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> deadline <span style=color:#f92672>=</span> Instant::now() <span style=color:#f92672>+</span> Duration::from_secs(device_response.expires_in);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>loop</span> {
</span></span><span style=display:flex><span>        tokio::time::sleep(interval).<span style=color:#66d9ef>await</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> Instant::now() <span style=color:#f92672>&gt;</span> deadline {
</span></span><span style=display:flex><span>            println!(<span style=color:#e6db74>&#34;Timed out waiting for authentication.&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> response <span style=color:#f92672>=</span> client
</span></span><span style=display:flex><span>            .post(format!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{vouch_url}</span><span style=color:#e6db74>/oauth/token&#34;</span>))
</span></span><span style=display:flex><span>            .form(<span style=color:#f92672>&amp;</span>[
</span></span><span style=display:flex><span>                (<span style=color:#e6db74>&#34;grant_type&#34;</span>, <span style=color:#e6db74>&#34;urn:ietf:params:oauth:grant-type:device_code&#34;</span>),
</span></span><span style=display:flex><span>                (<span style=color:#e6db74>&#34;device_code&#34;</span>, <span style=color:#f92672>&amp;</span>device_response.device_code),
</span></span><span style=display:flex><span>                (<span style=color:#e6db74>&#34;client_id&#34;</span>, <span style=color:#f92672>&amp;</span>client_id),
</span></span><span style=display:flex><span>            ])
</span></span><span style=display:flex><span>            .send()
</span></span><span style=display:flex><span>            .<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> response.status().is_success() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> tokens: <span style=color:#a6e22e>TokenResponse</span> <span style=color:#f92672>=</span> response.json().<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>            println!(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Authenticated successfully!&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> userinfo: <span style=color:#a6e22e>UserInfo</span> <span style=color:#f92672>=</span> client
</span></span><span style=display:flex><span>                .get(format!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{vouch_url}</span><span style=color:#e6db74>/oauth/userinfo&#34;</span>))
</span></span><span style=display:flex><span>                .bearer_auth(<span style=color:#f92672>&amp;</span>tokens.access_token)
</span></span><span style=display:flex><span>                .send()
</span></span><span style=display:flex><span>                .<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>                .json()
</span></span><span style=display:flex><span>                .<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            println!(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;Hello, </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>!&#34;</span>,
</span></span><span style=display:flex><span>                userinfo.name.unwrap_or_else(<span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;user&#34;</span>.to_string())
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> error: <span style=color:#a6e22e>ErrorResponse</span> <span style=color:#f92672>=</span> response.json().<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>match</span> error.error.as_str() {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;authorization_pending&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>continue</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;slow_down&#34;</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                interval <span style=color:#f92672>+=</span> Duration::from_secs(<span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;expired_token&#34;</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                println!(<span style=color:#e6db74>&#34;The device code has expired. Please try again.&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;access_denied&#34;</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                println!(<span style=color:#e6db74>&#34;Authentication was denied.&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            other <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                println!(<span style=color:#e6db74>&#34;Unexpected error: </span><span style=color:#e6db74>{other}</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Ok(())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=device-authorization-response>Device Authorization Response</h2><p>When your application requests a device code, the server returns the following fields:</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>device_code</code></td><td>string</td><td>The device verification code. Used by your application when polling the token endpoint. Do not display this to the user.</td></tr><tr><td><code>user_code</code></td><td>string</td><td>The end-user verification code. Display this to the user so they can enter it in their browser.</td></tr><tr><td><code>verification_uri</code></td><td>string</td><td>The URL the user should visit to enter the code and authenticate.</td></tr><tr><td><code>verification_uri_complete</code></td><td>string</td><td>Optional. A URL that includes the <code>user_code</code>, so the user can navigate directly without manually entering the code.</td></tr><tr><td><code>expires_in</code></td><td>number</td><td>The lifetime of the <code>device_code</code> and <code>user_code</code> in seconds.</td></tr><tr><td><code>interval</code></td><td>number</td><td>The minimum number of seconds your application should wait between polling requests.</td></tr></tbody></table><hr><h2 id=polling-errors>Polling Errors</h2><p>When polling the token endpoint during the device authorization flow, the server may return the following error codes:</p><table><thead><tr><th>Error</th><th>Description</th><th>Action</th></tr></thead><tbody><tr><td><code>authorization_pending</code></td><td>The user has not yet completed authentication.</td><td>Continue polling at the specified interval.</td></tr><tr><td><code>slow_down</code></td><td>Your application is polling too frequently.</td><td>Increase the polling interval by 5 seconds and continue.</td></tr><tr><td><code>expired_token</code></td><td>The <code>device_code</code> has expired.</td><td>Stop polling. Restart the flow by requesting a new device code.</td></tr><tr><td><code>access_denied</code></td><td>The user denied the authorization request.</td><td>Stop polling. Inform the user that authentication was denied.</td></tr></tbody></table></article></div><div class=sidebar-overlay id=sidebar-overlay onclick=closeSidebar()></div><button class=sidebar-toggle onclick=toggleSidebar() aria-label="Toggle sidebar">
<svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<script>function toggleSidebar(){document.getElementById("docs-sidebar").classList.toggle("open"),document.getElementById("sidebar-overlay").classList.toggle("open")}function closeSidebar(){document.getElementById("docs-sidebar").classList.remove("open"),document.getElementById("sidebar-overlay").classList.remove("open")}</script></main><footer class=footer><div class=footer-inner><div class=footer-left><div>&copy; 2026 Smoke Turner, LLC</div><div class=footer-instances>Instances:
<a href=https://us.vouch.sh>US</a>
&#183;
<span class=coming-soon>EU (coming soon)</span>
&#183;
<span class=coming-soon>APAC (coming soon)</span></div></div><div class=footer-links><a href=/about/>About</a>
<a href=/docs/security/>Security</a>
<a href=/privacy/>Privacy</a>
<a href=/terms/>Terms</a>
<a href=https://github.com/vouch-sh/vouch target=_blank rel=noopener>GitHub</a></div></div></footer></body></html>