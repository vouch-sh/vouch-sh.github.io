<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Replace SSH Keys with Short-Lived Certificates â€” Vouch â€” Hardware-Backed Developer Credentials</title>
<meta name=description content="Eliminate authorized_keys management. Vouch issues SSH certificates that expire in 8 hours â€” no key distribution, no offboarding checklist."><link rel=canonical href=https://vouch.sh/docs/ssh/><meta property="og:title" content="Replace SSH Keys with Short-Lived Certificates â€” Vouch â€” Hardware-Backed Developer Credentials"><meta property="og:description" content="Eliminate authorized_keys management. Vouch issues SSH certificates that expire in 8 hours â€” no key distribution, no offboarding checklist."><meta property="og:url" content="https://vouch.sh/docs/ssh/"><meta property="og:site_name" content="Vouch"><meta property="og:type" content="article"><meta property="og:image" content="https://vouch.sh/img/og-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Replace SSH Keys with Short-Lived Certificates â€” Vouch â€” Hardware-Backed Developer Credentials"><meta name=twitter:description content="Eliminate authorized_keys management. Vouch issues SSH certificates that expire in 8 hours â€” no key distribution, no offboarding checklist."><meta name=twitter:image content="https://vouch.sh/img/og-image.png"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”‘</text></svg>"><link rel=author href=/humans.txt><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","description":"Open-source credential broker that issues short-lived SSH, AWS, GitHub, and Kubernetes credentials after FIDO2 hardware verification. One YubiKey tap, 8 hours of access.","name":"Vouch","url":"https://vouch.sh/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","logo":"https://vouch.sh/img/og-image.png","name":"Smoke Turner, LLC","sameAs":["https://github.com/vouch-sh/vouch"],"url":"https://smoketurner.com"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"TechArticle","author":{"@type":"Organization","name":"Smoke Turner, LLC"},"description":"Eliminate authorized_keys management. Vouch issues SSH certificates that expire in 8 hours â€” no key distribution, no offboarding checklist.","headline":"Replace SSH Keys with Short-Lived Certificates","mainEntityOfPage":{"@id":"https://vouch.sh/docs/ssh/","@type":"WebPage"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://vouch.sh/img/og-image.png"},"name":"Smoke Turner, LLC"}}</script><link rel=stylesheet href=https://vouch.sh/css/main.min.696319dec26a9f9526ac8dae8c8e12c4271af4250b998632e1aca67447bb363d.css></head><body><header class=nav><div class=nav-inner><a href=/ class=nav-logo><svg viewBox="0 0 32 32" fill="none"><rect x="9" y="14" width="14" height="12" rx="2" stroke="currentcolor" stroke-width="2"/><path d="M12 14V10a4 4 0 118 0v4" stroke="currentcolor" stroke-width="2" stroke-linecap="round"/><circle cx="16" cy="20" r="1.5" fill="currentcolor"/><line x1="16" y1="21.5" x2="16" y2="23.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/></svg>
vouch
</a><button class=nav-toggle aria-label="Toggle navigation" onclick='document.querySelector(".nav-links").classList.toggle("open")'><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><ul class=nav-links><li><a href=/docs/>Docs</a></li><li><a href=/blog/>Blog</a></li><li><a href=/about/>About</a></li><li><a href=https://github.com/vouch-sh/vouch target=_blank rel=noopener>GitHub<svg class="github-icon" viewBox="0 0 24 24" fill="currentcolor"><path d="M12 0C5.37.0.0 5.37.0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57.0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925.0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18.0.0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225.0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22.0 1.605-.015 2.895-.015 3.3.0.315.225.69.825.57A12.02 12.02.0 0024 12c0-6.63-5.37-12-12-12z"/></svg></a></li></ul></div></header><main class=content-wrapper><div class=docs-layout><aside class=docs-sidebar id=docs-sidebar><div class=docs-sidebar-title>Documentation</div><nav><ul><li><a href=https://vouch.sh/docs/getting-started/>Getting Started</a></li><li><a href=https://vouch.sh/docs/startups/>Startups</a></li><li class=sidebar-section-group><span class=sidebar-section-label>Infrastructure</span><ul><li><a href=https://vouch.sh/docs/aws/>AWS</a></li><li><a href=https://vouch.sh/docs/aws-multi-account/>AWS Multi-Account</a></li><li><a href=https://vouch.sh/docs/ssh/ class=active>SSH Certificates</a></li><li><a href=https://vouch.sh/docs/eks/>Amazon EKS</a></li><li><a href=https://vouch.sh/docs/ssm/>AWS Systems Manager</a></li><li><a href=https://vouch.sh/docs/databases/>Databases</a></li><li><a href=https://vouch.sh/docs/bedrock/>Amazon Bedrock</a></li></ul></li><li class=sidebar-section-group><span class=sidebar-section-label>Code & Packages</span><ul><li><a href=https://vouch.sh/docs/github/>GitHub</a></li><li><a href=https://vouch.sh/docs/docker/>Docker Registries</a></li><li><a href=https://vouch.sh/docs/codeartifact/>AWS CodeArtifact</a></li><li><a href=https://vouch.sh/docs/codecommit/>AWS CodeCommit</a></li><li><a href=https://vouch.sh/docs/cargo/>Cargo</a></li></ul></li><li class=sidebar-section-group><span class=sidebar-section-label>Platform</span><ul><li class=sidebar-group><div class=sidebar-group-header><a href=https://vouch.sh/docs/applications/>Applications (OIDC)
</a><button class=sidebar-chevron onclick='this.closest(".sidebar-group").classList.toggle("open")' aria-label="Toggle section"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></button></div><ul class=sidebar-children><li><a href=https://vouch.sh/docs/applications/rails/>Rails (OmniAuth)</a></li><li><a href=https://vouch.sh/docs/applications/django/>Django (django-allauth)</a></li><li><a href=https://vouch.sh/docs/applications/express/>Express.js (Passport)</a></li><li><a href=https://vouch.sh/docs/applications/nextjs/>Next.js (NextAuth.js)</a></li><li><a href=https://vouch.sh/docs/applications/laravel/>Laravel (Socialite)</a></li><li><a href=https://vouch.sh/docs/applications/flask/>Flask (Authlib)</a></li><li><a href=https://vouch.sh/docs/applications/fastapi/>FastAPI (Authlib)</a></li><li><a href=https://vouch.sh/docs/applications/spring-boot/>Spring Boot (Spring Security)</a></li><li><a href=https://vouch.sh/docs/applications/axum/>Axum (openidconnect-rs)</a></li><li><a href=https://vouch.sh/docs/applications/react/>React (react-oidc-context)</a></li><li><a href=https://vouch.sh/docs/applications/vue/>Vue (oidc-client-ts)</a></li><li><a href=https://vouch.sh/docs/applications/vanilla-js/>Vanilla JavaScript</a></li><li><a href=https://vouch.sh/docs/applications/device-authorization/>Device Authorization (CLI)</a></li></ul></li><li><a href=https://vouch.sh/docs/scim/>SCIM Provisioning</a></li><li><a href=https://vouch.sh/docs/iac/>Infrastructure as Code</a></li><li><a href=https://vouch.sh/docs/cicd/>CI/CD</a></li><li><a href=https://vouch.sh/docs/cli-reference/>CLI Reference</a></li><li><a href=https://vouch.sh/docs/security/>Security</a></li><li><a href=https://vouch.sh/docs/threat-model/>Threat Model</a></li><li><a href=https://vouch.sh/docs/architecture/>Architecture</a></li><li><a href=https://vouch.sh/docs/availability/>Availability</a></li><li><a href=https://vouch.sh/docs/migration/>Migration</a></li><li><a href=https://vouch.sh/docs/faq/>FAQ</a></li></ul></li></ul></nav></aside><article class=docs-content><div class=docs-breadcrumb><a href=https://vouch.sh/docs/>Docs</a><span class=separator>/</span>
Replace SSH Keys with Short-Lived Certificates</div><h1>Replace SSH Keys with Short-Lived Certificates</h1><p style=color:var(--text-muted);font-size:1.1rem;margin-bottom:2rem>Configure SSH servers to trust Vouch certificates for passwordless authentication</p><p>Managing SSH access with traditional public keys is one of the most painful parts of growing a team. Every new hire means copying keys to every server. Every departure means hunting down and removing keys you hope you can find. Keys never expire, and there is no way to know who used them.</p><p>Vouch eliminates this entirely. Administrators trust a single certificate authority (CA) key, and developers receive short-lived SSH certificates that expire after 8 hours. There is no key distribution, no <code>authorized_keys</code> sprawl, and no offboarding checklist. Developers authenticate with <code>vouch login</code> and then <code>ssh</code> into any trusted server without passwords or key copying.</p><h2 id=how-it-works>How it works</h2><ol><li>During <code>vouch login</code>, the Vouch server signs the developer&rsquo;s ephemeral public key with an <strong>Ed25519 CA</strong> key.</li><li>The resulting SSH certificate is valid for <strong>8 hours</strong> and contains the developer&rsquo;s <strong>email address</strong> and <strong>username</strong> as principals.</li><li>When the developer connects to a server, the SSH client presents the certificate.</li><li>The server verifies the certificate was signed by the trusted CA and that one of the certificate&rsquo;s principals matches an allowed user.</li><li>The connection is established without any <code>authorized_keys</code> lookup.</li></ol><p>Because certificates expire after 8 hours, a compromised certificate is useless the next day. There is nothing to revoke and nothing to rotate.</p><hr><h2 id=step-1----set-up-the-cli-for-developers>Step 1 &ndash; Set up the CLI (for developers)</h2><p>After completing the <a href=/docs/getting-started/>Getting Started</a> guide, enable the SSH agent integration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vouch setup ssh
</span></span></code></pre></div><p>This command configures your local SSH client to use the Vouch agent for certificate authentication. It adds the following to your <code>~/.ssh/config</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Host *
</span></span><span style=display:flex><span>  IdentityAgent ~/.vouch/ssh-agent.sock
</span></span></code></pre></div><p>After setup, every <code>ssh</code> connection will automatically use your Vouch certificate when available, falling back to regular keys if needed.</p><h3 id=verify-the-agent-is-running>Verify the agent is running</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vouch status
</span></span></code></pre></div><p>Look for the SSH agent line in the output. If the agent is not running, <code>vouch login</code> will start it automatically.</p><h3 id=check-your-certificate>Check your certificate</h3><p>After logging in, inspect the current certificate:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vouch credential ssh
</span></span></code></pre></div><p>This obtains a certificate from the server and displays the certificate&rsquo;s principals, validity period, and signing CA.</p><hr><h2 id=step-2----configure-ssh-servers-for-administrators>Step 2 &ndash; Configure SSH servers (for administrators)</h2><p>To accept Vouch certificates, each server must trust the Vouch CA public key. Below are three approaches for deploying this configuration.</p><h3 id=fetch-the-ca-public-key>Fetch the CA public key</h3><p>First, retrieve your organization&rsquo;s CA public key from the Vouch server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s https://us.vouch.sh/ssh/ca.pub
</span></span></code></pre></div><p>Save the output &ndash; you will need it for each method below.</p><hr><h3 id=cli-manual>CLI (manual)</h3><p>On each server, add the CA public key and configure <code>sshd</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Write the CA public key</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;CONTENTS_OF_CA_PUB&#34;</span> | sudo tee /etc/ssh/vouch_ca.pub
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Tell sshd to trust certificates signed by this CA</span>
</span></span><span style=display:flex><span><span style=color:#75715e># See: https://man.openbsd.org/sshd_config#TrustedUserCAKeys</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;TrustedUserCAKeys /etc/ssh/vouch_ca.pub&#34;</span> | sudo tee -a /etc/ssh/sshd_config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Optionally set AuthorizedPrincipalsFile to control which principals are allowed</span>
</span></span><span style=display:flex><span><span style=color:#75715e># See: https://man.openbsd.org/sshd_config#AuthorizedPrincipalsFile</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;AuthorizedPrincipalsFile /etc/ssh/auth_principals/%u&#34;</span> | sudo tee -a /etc/ssh/sshd_config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create a principals file for a specific user</span>
</span></span><span style=display:flex><span>sudo mkdir -p /etc/ssh/auth_principals
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;alice@example.com&#34;</span> | sudo tee /etc/ssh/auth_principals/alice
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Restart sshd</span>
</span></span><span style=display:flex><span>sudo systemctl restart sshd
</span></span></code></pre></div><hr><h3 id=ansible>Ansible</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Configure Vouch SSH CA trust</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>all</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>vars</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>vouch_ca_pub</span>: <span style=color:#e6db74>&#34;{{ lookup(&#39;url&#39;, &#39;https://us.vouch.sh/ssh/ca.pub&#39;) }}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Write Vouch CA public key</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>copy</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>content</span>: <span style=color:#e6db74>&#34;{{ vouch_ca_pub }}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>/etc/ssh/vouch_ca.pub</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>owner</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;0644&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Trust Vouch CA for user certificates</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>lineinfile</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/etc/ssh/sshd_config</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regexp</span>: <span style=color:#e6db74>&#34;^TrustedUserCAKeys&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>line</span>: <span style=color:#e6db74>&#34;TrustedUserCAKeys /etc/ssh/vouch_ca.pub&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>notify</span>: <span style=color:#ae81ff>restart sshd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Set AuthorizedPrincipalsFile</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>lineinfile</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/etc/ssh/sshd_config</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regexp</span>: <span style=color:#e6db74>&#34;^AuthorizedPrincipalsFile&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>line</span>: <span style=color:#e6db74>&#34;AuthorizedPrincipalsFile /etc/ssh/auth_principals/%u&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>notify</span>: <span style=color:#ae81ff>restart sshd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create auth_principals directory</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>file</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/etc/ssh/auth_principals</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>state</span>: <span style=color:#ae81ff>directory</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>owner</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;0755&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>handlers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>restart sshd</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sshd</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>state</span>: <span style=color:#ae81ff>restarted</span>
</span></span></code></pre></div><hr><h3 id=terraform-aws-ec2-user-data>Terraform (AWS EC2 user data)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_instance&#34; &#34;example&#34;</span> {
</span></span><span style=display:flex><span>  ami           <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ami-0abcdef1234567890&#34;</span>
</span></span><span style=display:flex><span>  instance_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;t3.micro&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  user_data <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>&lt;&lt;-</span><span style=color:#66d9ef>EOF</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    #!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>set</span> <span style=color:#960050;background-color:#1e0010>-</span><span style=color:#66d9ef>e</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    # Fetch and install the Vouch CA public key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>curl</span> <span style=color:#960050;background-color:#1e0010>-</span><span style=color:#66d9ef>s</span> <span style=color:#66d9ef>https</span><span style=color:#960050;background-color:#1e0010>://</span><span style=color:#66d9ef>us.vouch.sh</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>ssh</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>ca</span>.<span style=color:#66d9ef>pub</span> \
</span></span><span style=display:flex><span>      <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#66d9ef>tee</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>etc</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>ssh</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>vouch_ca</span>.<span style=color:#66d9ef>pub</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    # Configure sshd to trust the CA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;TrustedUserCAKeys /etc/ssh/vouch_ca.pub&#34;</span> <span style=color:#960050;background-color:#1e0010>&gt;&gt;</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>etc</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>ssh</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>sshd_config</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;AuthorizedPrincipalsFile /etc/ssh/auth_principals/%u&#34;</span> <span style=color:#960050;background-color:#1e0010>&gt;&gt;</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>etc</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>ssh</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>sshd_config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>mkdir</span> <span style=color:#960050;background-color:#1e0010>-</span><span style=color:#66d9ef>p</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>etc</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>ssh</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>auth_principals</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>systemctl</span> <span style=color:#66d9ef>restart</span> <span style=color:#66d9ef>sshd</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  tags <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    Name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;vouch-ssh-example&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=tip-understanding-principals>Tip: understanding principals</h2><p>Vouch certificates include two principals by default:</p><table><thead><tr><th>Principal</th><th>Example</th><th>Use case</th></tr></thead><tbody><tr><td>Email address</td><td><code>alice@example.com</code></td><td>Unique per-user access control</td></tr><tr><td>Username</td><td><code>alice</code></td><td>Matches standard Unix usernames</td></tr></tbody></table><p>When configuring <code>AuthorizedPrincipalsFile</code>, you can list either the email or the username (or both) in the principals file for each Unix account.</p><p><strong>Example:</strong> To allow both <code>alice@example.com</code> and <code>bob@example.com</code> to SSH as the <code>deploy</code> user:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /etc/ssh/auth_principals
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;alice@example.com\nbob@example.com\n&#34;</span> | sudo tee /etc/ssh/auth_principals/deploy
</span></span></code></pre></div><p>If you do not configure <code>AuthorizedPrincipalsFile</code>, OpenSSH will accept any certificate signed by the trusted CA. This is convenient for testing but is not recommended for production.</p><hr><h2 id=step-3----test-the-connection>Step 3 &ndash; Test the connection</h2><p>From a developer machine with an active Vouch session:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Log in if you have not already</span>
</span></span><span style=display:flex><span>vouch login
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Connect to a configured server</span>
</span></span><span style=display:flex><span>ssh alice@server.example.com
</span></span></code></pre></div><p>The connection should succeed without prompting for a password or key passphrase. To verify that certificate authentication was used, check the server&rsquo;s auth log:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># On the server</span>
</span></span><span style=display:flex><span>sudo grep <span style=color:#e6db74>&#34;Accepted certificate&#34;</span> /var/log/auth.log
</span></span></code></pre></div><p>You should see an entry like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Accepted publickey for alice from 192.168.1.100 port 54321 ssh2: ED25519-CERT SHA256:... ID &#34;alice@example.com&#34; serial 42 CA ED25519 SHA256:...
</span></span></code></pre></div><hr><h2 id=how-certificate-authentication-works>How certificate authentication works</h2><p>Here is the full flow in detail:</p><ol><li><p><strong>Login</strong> &ndash; The developer runs <code>vouch login</code>, authenticates with their YubiKey (PIN + touch), and receives a signed SSH certificate from the Vouch server&rsquo;s Ed25519 CA.</p></li><li><p><strong>Connection</strong> &ndash; The developer runs <code>ssh user@server</code>. The SSH client, configured to use the Vouch agent, presents the certificate to the server.</p></li><li><p><strong>CA verification</strong> &ndash; The server checks that the certificate is signed by a CA listed in <code>TrustedUserCAKeys</code>. If the signature is invalid or the CA is not trusted, the connection is rejected.</p></li><li><p><strong>Principal matching</strong> &ndash; The server checks whether any principal in the certificate matches an entry in the <code>AuthorizedPrincipalsFile</code> for the target Unix user. If no principals file is configured, any valid certificate is accepted.</p></li><li><p><strong>Session established</strong> &ndash; If both checks pass, the SSH session is established. The certificate&rsquo;s validity period (8 hours from login) is enforced &ndash; expired certificates are rejected at step 3.</p></li></ol><hr><h2 id=troubleshooting>Troubleshooting</h2><h3 id=permission-denied-publickey>&ldquo;Permission denied (publickey)&rdquo;</h3><ul><li>Confirm you have an active Vouch session: run <code>vouch status</code>.</li><li>Verify the Vouch agent is running and <code>~/.ssh/config</code> includes the <code>IdentityAgent</code> line.</li><li>Check that the server has <code>TrustedUserCAKeys</code> pointing to the correct CA public key.</li><li>If using <code>AuthorizedPrincipalsFile</code>, verify that the file for the target user contains one of the certificate&rsquo;s principals (email or username).</li></ul><h3 id=certificate-has-expired>&ldquo;Certificate has expired&rdquo;</h3><ul><li>SSH certificates issued by Vouch are valid for 8 hours. Run <code>vouch login</code> to get a fresh certificate.</li></ul><h3 id=agent-not-found>Agent not found</h3><ul><li>Run <code>vouch login</code> to start the agent, or restart it with <code>vouch setup ssh</code>.</li><li>Verify the socket path exists: <code>ls -la ~/.vouch/ssh-agent.sock</code>.</li></ul><h3 id=server-rejects-the-certificate-even-though-it-was-signed-by-the-right-ca>Server rejects the certificate even though it was signed by the right CA</h3><ul><li>Check <code>AuthorizedPrincipalsFile</code> permissions. The file and its parent directory must be owned by root and not writable by group or others.</li><li>Ensure the principals file is in the correct location (<code>/etc/ssh/auth_principals/&lt;username></code>).</li><li>Review <code>/var/log/auth.log</code> (or <code>/var/log/secure</code> on RHEL-based systems) for detailed error messages.</li></ul><h3 id=connection-falls-back-to-password-authentication>Connection falls back to password authentication</h3><ul><li>The server may not have <code>TrustedUserCAKeys</code> configured, or <code>sshd</code> may not have been restarted after the configuration change.</li><li>Run <code>ssh -v user@server</code> to see which authentication methods are attempted. Look for <code>Offering public key: ... ED25519-CERT</code> in the debug output.</li></ul><hr><h2 id=ide-remote-development>IDE Remote Development</h2><p>Because Vouch configures <code>~/.ssh/config</code> with its agent, tools that build on top of SSH work automatically:</p><ul><li><strong>VS Code Remote-SSH</strong> &ndash; Open remote folders and terminals on any server trusted by the Vouch CA. No additional extension configuration is needed.</li><li><strong>JetBrains Gateway</strong> &ndash; Connect to remote development environments using the same SSH certificate.</li><li><strong>scp / rsync / sftp</strong> &ndash; File transfers use the Vouch SSH agent transparently.</li></ul><p>As long as the Vouch agent is running and you have an active session, any tool that uses the system SSH client will authenticate with your Vouch certificate.</p></article></div><div class=sidebar-overlay id=sidebar-overlay onclick=closeSidebar()></div><button class=sidebar-toggle onclick=toggleSidebar() aria-label="Toggle sidebar">
<svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<script>function toggleSidebar(){document.getElementById("docs-sidebar").classList.toggle("open"),document.getElementById("sidebar-overlay").classList.toggle("open")}function closeSidebar(){document.getElementById("docs-sidebar").classList.remove("open"),document.getElementById("sidebar-overlay").classList.remove("open")}</script></main><footer class=footer><div class=footer-inner><div class=footer-left><div>&copy; 2026 Smoke Turner, LLC</div><div class=footer-instances>Instances:
<a href=https://us.vouch.sh>US</a>
&#183;
<span class=coming-soon>EU (coming soon)</span>
&#183;
<span class=coming-soon>APAC (coming soon)</span></div></div><div class=footer-links><a href=/about/>About</a>
<a href=/docs/security/>Security</a>
<a href=/privacy/>Privacy</a>
<a href=/terms/>Terms</a>
<a href=https://github.com/vouch-sh/vouch target=_blank rel=noopener>GitHub</a></div></div></footer></body></html>