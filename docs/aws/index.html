<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Replace AWS Access Keys with Short-Lived Credentials â€” Vouch â€” Hardware-Backed Developer Credentials</title>
<meta name=description content="Stop distributing long-lived AWS access keys. Use OIDC federation to get temporary STS credentials backed by a YubiKey."><link rel=canonical href=https://vouch.sh/docs/aws/><meta property="og:title" content="Replace AWS Access Keys with Short-Lived Credentials â€” Vouch â€” Hardware-Backed Developer Credentials"><meta property="og:description" content="Stop distributing long-lived AWS access keys. Use OIDC federation to get temporary STS credentials backed by a YubiKey."><meta property="og:url" content="https://vouch.sh/docs/aws/"><meta property="og:site_name" content="Vouch"><meta property="og:type" content="article"><meta property="og:image" content="https://vouch.sh/img/og-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Replace AWS Access Keys with Short-Lived Credentials â€” Vouch â€” Hardware-Backed Developer Credentials"><meta name=twitter:description content="Stop distributing long-lived AWS access keys. Use OIDC federation to get temporary STS credentials backed by a YubiKey."><meta name=twitter:image content="https://vouch.sh/img/og-image.png"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”‘</text></svg>"><link rel=author href=/humans.txt><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","description":"Open-source credential broker that issues short-lived SSH, AWS, GitHub, and Kubernetes credentials after FIDO2 hardware verification. One YubiKey tap, 8 hours of access.","name":"Vouch","url":"https://vouch.sh/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","logo":"https://vouch.sh/img/og-image.png","name":"Smoke Turner, LLC","sameAs":["https://github.com/vouch-sh/vouch"],"url":"https://smoketurner.com"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"TechArticle","author":{"@type":"Organization","name":"Smoke Turner, LLC"},"description":"Stop distributing long-lived AWS access keys. Use OIDC federation to get temporary STS credentials backed by a YubiKey.","headline":"Replace AWS Access Keys with Short-Lived Credentials","mainEntityOfPage":{"@id":"https://vouch.sh/docs/aws/","@type":"WebPage"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://vouch.sh/img/og-image.png"},"name":"Smoke Turner, LLC"}}</script><link rel=stylesheet href=https://vouch.sh/css/main.min.696319dec26a9f9526ac8dae8c8e12c4271af4250b998632e1aca67447bb363d.css></head><body><header class=nav><div class=nav-inner><a href=/ class=nav-logo><svg viewBox="0 0 32 32" fill="none"><rect x="9" y="14" width="14" height="12" rx="2" stroke="currentcolor" stroke-width="2"/><path d="M12 14V10a4 4 0 118 0v4" stroke="currentcolor" stroke-width="2" stroke-linecap="round"/><circle cx="16" cy="20" r="1.5" fill="currentcolor"/><line x1="16" y1="21.5" x2="16" y2="23.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/></svg>
vouch
</a><button class=nav-toggle aria-label="Toggle navigation" onclick='document.querySelector(".nav-links").classList.toggle("open")'><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><ul class=nav-links><li><a href=/docs/>Docs</a></li><li><a href=/blog/>Blog</a></li><li><a href=/about/>About</a></li><li><a href=https://github.com/vouch-sh/vouch target=_blank rel=noopener>GitHub<svg class="github-icon" viewBox="0 0 24 24" fill="currentcolor"><path d="M12 0C5.37.0.0 5.37.0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57.0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925.0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18.0.0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225.0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22.0 1.605-.015 2.895-.015 3.3.0.315.225.69.825.57A12.02 12.02.0 0024 12c0-6.63-5.37-12-12-12z"/></svg></a></li></ul></div></header><main class=content-wrapper><div class=docs-layout><aside class=docs-sidebar id=docs-sidebar><div class=docs-sidebar-title>Documentation</div><nav><ul><li><a href=https://vouch.sh/docs/getting-started/>Getting Started</a></li><li><a href=https://vouch.sh/docs/startups/>Startups</a></li><li class=sidebar-section-group><span class=sidebar-section-label>Infrastructure</span><ul><li><a href=https://vouch.sh/docs/aws/ class=active>AWS</a></li><li><a href=https://vouch.sh/docs/aws-multi-account/>AWS Multi-Account</a></li><li><a href=https://vouch.sh/docs/ssh/>SSH Certificates</a></li><li><a href=https://vouch.sh/docs/eks/>Amazon EKS</a></li><li><a href=https://vouch.sh/docs/ssm/>AWS Systems Manager</a></li><li><a href=https://vouch.sh/docs/databases/>Databases</a></li><li><a href=https://vouch.sh/docs/bedrock/>Amazon Bedrock</a></li></ul></li><li class=sidebar-section-group><span class=sidebar-section-label>Code & Packages</span><ul><li><a href=https://vouch.sh/docs/github/>GitHub</a></li><li><a href=https://vouch.sh/docs/docker/>Docker Registries</a></li><li><a href=https://vouch.sh/docs/codeartifact/>AWS CodeArtifact</a></li><li><a href=https://vouch.sh/docs/codecommit/>AWS CodeCommit</a></li><li><a href=https://vouch.sh/docs/cargo/>Cargo</a></li></ul></li><li class=sidebar-section-group><span class=sidebar-section-label>Platform</span><ul><li class=sidebar-group><div class=sidebar-group-header><a href=https://vouch.sh/docs/applications/>Applications (OIDC)
</a><button class=sidebar-chevron onclick='this.closest(".sidebar-group").classList.toggle("open")' aria-label="Toggle section"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></button></div><ul class=sidebar-children><li><a href=https://vouch.sh/docs/applications/rails/>Rails (OmniAuth)</a></li><li><a href=https://vouch.sh/docs/applications/django/>Django (django-allauth)</a></li><li><a href=https://vouch.sh/docs/applications/express/>Express.js (Passport)</a></li><li><a href=https://vouch.sh/docs/applications/nextjs/>Next.js (NextAuth.js)</a></li><li><a href=https://vouch.sh/docs/applications/laravel/>Laravel (Socialite)</a></li><li><a href=https://vouch.sh/docs/applications/flask/>Flask (Authlib)</a></li><li><a href=https://vouch.sh/docs/applications/fastapi/>FastAPI (Authlib)</a></li><li><a href=https://vouch.sh/docs/applications/spring-boot/>Spring Boot (Spring Security)</a></li><li><a href=https://vouch.sh/docs/applications/axum/>Axum (openidconnect-rs)</a></li><li><a href=https://vouch.sh/docs/applications/react/>React (react-oidc-context)</a></li><li><a href=https://vouch.sh/docs/applications/vue/>Vue (oidc-client-ts)</a></li><li><a href=https://vouch.sh/docs/applications/vanilla-js/>Vanilla JavaScript</a></li><li><a href=https://vouch.sh/docs/applications/device-authorization/>Device Authorization (CLI)</a></li></ul></li><li><a href=https://vouch.sh/docs/scim/>SCIM Provisioning</a></li><li><a href=https://vouch.sh/docs/iac/>Infrastructure as Code</a></li><li><a href=https://vouch.sh/docs/cicd/>CI/CD</a></li><li><a href=https://vouch.sh/docs/cli-reference/>CLI Reference</a></li><li><a href=https://vouch.sh/docs/security/>Security</a></li><li><a href=https://vouch.sh/docs/threat-model/>Threat Model</a></li><li><a href=https://vouch.sh/docs/architecture/>Architecture</a></li><li><a href=https://vouch.sh/docs/availability/>Availability</a></li><li><a href=https://vouch.sh/docs/migration/>Migration</a></li><li><a href=https://vouch.sh/docs/faq/>FAQ</a></li></ul></li></ul></nav></aside><article class=docs-content><div class=docs-breadcrumb><a href=https://vouch.sh/docs/>Docs</a><span class=separator>/</span>
Replace AWS Access Keys with Short-Lived Credentials</div><h1>Replace AWS Access Keys with Short-Lived Credentials</h1><p style=color:var(--text-muted);font-size:1.1rem;margin-bottom:2rem>Configure AWS IAM to trust Vouch as an OIDC identity provider</p><p>If your team distributes AWS access keys through <code>~/.aws/credentials</code>, you have credentials that never expire, are trivially exfiltrated by malware, and leave no trace of who used them. Rotating keys is a manual chore that rarely happens on schedule, and a single compromised laptop exposes keys that work indefinitely.</p><p>Vouch eliminates static access keys entirely. You configure AWS to trust Vouch as an OIDC identity provider, and developers get temporary STS credentials &ndash; valid for up to 1 hour &ndash; after authenticating with their YubiKey. Every API call is tied to a verified human identity in CloudTrail. There are no keys to rotate, no credentials on disk, and no shared secrets.</p><h2 id=how-vouch-compares-to-aws-login-and-aws-sso-login>How Vouch compares to <code>aws login</code> and <code>aws sso login</code></h2><p>AWS provides two built-in CLI authentication commands. Here is how they compare to Vouch:</p><ul><li><p><strong><a href=https://docs.aws.amazon.com/signin/latest/userguide/command-line-sign-in.html#command-line-sign-in-local-development><code>aws login</code></a></strong> &ndash; New in AWS CLI v2.32+. Opens a browser to authenticate with your AWS Console credentials (IAM user, root, or federated identity) and issues temporary credentials for up to 12 hours. It requires the <code>SignInLocalDevelopmentAccess</code> managed policy and only covers AWS &ndash; it does not provide credentials for SSH, GitHub, Docker registries, or other services.</p></li><li><p><strong><a href=https://docs.aws.amazon.com/signin/latest/userguide/command-line-sign-in.html#command-line-sign-in-sso><code>aws sso login</code></a></strong> &ndash; Authenticates through AWS IAM Identity Center (formerly AWS SSO). It requires an Identity Center instance and an SSO-configured profile (<code>aws configure sso</code>). Like <code>aws login</code>, it only covers AWS services.</p></li><li><p><strong><code>vouch login</code></strong> &ndash; Authenticates with a FIDO2 hardware key (YubiKey) and provides credentials for AWS, SSH, GitHub, Docker registries, Cargo registries, AWS CodeCommit, AWS CodeArtifact, databases, and any OIDC-compatible application &ndash; all from a single session. Every credential is tied to a hardware-verified human identity, and authentication is phishing-resistant by design.</p></li></ul><table><thead><tr><th></th><th><code>aws login</code></th><th><code>aws sso login</code></th><th><code>vouch login</code></th></tr></thead><tbody><tr><td><strong>Authentication</strong></td><td>Browser + console credentials</td><td>Browser + Identity Center</td><td>YubiKey tap (FIDO2)</td></tr><tr><td><strong>Phishing-resistant</strong></td><td>Depends on IdP</td><td>Depends on IdP</td><td>Yes (hardware-bound)</td></tr><tr><td><strong>AWS credentials</strong></td><td>Yes (up to 12h)</td><td>Yes</td><td>Yes (up to 1h)</td></tr><tr><td><strong>SSH, GitHub, Docker, etc.</strong></td><td>No</td><td>No</td><td>Yes</td></tr><tr><td><strong>Identity in CloudTrail</strong></td><td>IAM user or role</td><td>SSO user</td><td>Hardware-verified user</td></tr><tr><td><strong>Requires AWS-managed service</strong></td><td>No</td><td>IAM Identity Center</td><td>No</td></tr></tbody></table><p>If you already use IAM Identity Center, <code>aws sso login</code> may cover your AWS needs. Vouch is a better fit when you want a single authentication event to cover AWS and everything else your team uses, with the guarantee that every credential traces back to a physical hardware key.</p><h2 id=how-it-works>How it works</h2><ol><li>The developer runs <code>vouch login</code> and authenticates with their YubiKey.</li><li>The Vouch server issues a short-lived <strong>OIDC ID token</strong> signed with <strong>ES256</strong> (ECDSA over P-256). The token contains claims such as <code>sub</code> (user ID) and <code>email</code>.</li><li>When the developer runs an AWS command (or <code>vouch credential aws</code>), the CLI calls <strong>AWS STS AssumeRoleWithWebIdentity</strong>, presenting the ID token.</li><li>AWS validates the token signature against the Vouch server&rsquo;s JWKS endpoint, checks the audience and issuer, and returns temporary credentials (access key, secret key, session token) valid for up to 1 hour.</li><li>The developer&rsquo;s AWS CLI, SDK, or Terraform session uses these credentials transparently.</li></ol><p>Because the ID token is scoped to the authenticated user and is short-lived, credentials cannot be shared or reused after expiry.</p><hr><h2 id=step-1----create-the-oidc-provider-in-aws-admin>Step 1 &ndash; Create the OIDC Provider in AWS (admin)</h2><p>Before any user can assume a role, an administrator must register the Vouch server as an OIDC identity provider in the target AWS account.</p><h3 id=aws-cli>AWS CLI</h3><blockquote><p>For background on OIDC identity providers in AWS, see <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_oidc.html>Creating OpenID Connect (OIDC) identity providers</a> in the AWS documentation.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws iam create-open-id-connect-provider <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --url <span style=color:#e6db74>&#34;https://us.vouch.sh&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --client-id-list <span style=color:#e6db74>&#34;https://us.vouch.sh&#34;</span>
</span></span></code></pre></div><blockquote><p><strong>Note:</strong> AWS fetches the JWKS from <code>https://us.vouch.sh/.well-known/jwks.json</code> at runtime to verify token signatures. A <code>ThumbprintList</code> is no longer required &ndash; AWS obtains the root CA thumbprint automatically.</p></blockquote><h3 id=cloudformation>CloudFormation</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>AWSTemplateFormatVersion</span>: <span style=color:#e6db74>&#34;2010-09-09&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Description</span>: <span style=color:#ae81ff>Vouch OIDC Identity Provider</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>VouchOIDCProvider</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#e6db74>&#34;AWS::IAM::OIDCProvider&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Url</span>: <span style=color:#e6db74>&#34;https://us.vouch.sh&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ClientIdList</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#34;https://us.vouch.sh&#34;</span>
</span></span></code></pre></div><h3 id=terraform>Terraform</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_openid_connect_provider&#34; &#34;vouch&#34;</span> {
</span></span><span style=display:flex><span>  url            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://us.vouch.sh&#34;</span>
</span></span><span style=display:flex><span>  client_id_list <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;https://us.vouch.sh&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=step-2----create-an-iam-role-admin>Step 2 &ndash; Create an IAM Role (admin)</h2><p>Create an IAM role that developers will assume. The trust policy must allow <a href=https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithWebIdentity.html><code>AssumeRoleWithWebIdentity</code></a> from the Vouch OIDC provider.</p><h3 id=aws-cli-1>AWS CLI</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ACCOUNT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws sts get-caller-identity --query Account --output text<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &gt; /tmp/vouch-trust-policy.json <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;Version&#34;: &#34;2012-10-17&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;Statement&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Principal&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;Federated&#34;: &#34;arn:aws:iam::${ACCOUNT_ID}:oidc-provider/us.vouch.sh&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Action&#34;: &#34;sts:AssumeRoleWithWebIdentity&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Condition&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;StringEquals&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &#34;us.vouch.sh:aud&#34;: &#34;us.vouch.sh&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws iam create-role <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --role-name VouchDeveloper <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --assume-role-policy-document file:///tmp/vouch-trust-policy.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Attach a permissions policy (example: read-only access)</span>
</span></span><span style=display:flex><span>aws iam attach-role-policy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --role-name VouchDeveloper <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --policy-arn arn:aws:iam::aws:policy/ReadOnlyAccess
</span></span></code></pre></div><h3 id=cloudformation-1>CloudFormation</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>VouchDeveloperRole</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::IAM::Role</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>RoleName</span>: <span style=color:#ae81ff>VouchDeveloper</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>AssumeRolePolicyDocument</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>Version</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>Statement</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>Effect</span>: <span style=color:#ae81ff>Allow</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>Principal</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>Federated</span>: !<span style=color:#ae81ff>Sub &#34;arn:aws:iam::${AWS::AccountId}:oidc-provider/us.vouch.sh&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>Action</span>: <span style=color:#e6db74>&#34;sts:AssumeRoleWithWebIdentity&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>Condition</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>StringEquals</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;us.vouch.sh:aud&#34;: </span><span style=color:#e6db74>&#34;us.vouch.sh&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ManagedPolicyArns</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>arn:aws:iam::aws:policy/ReadOnlyAccess</span>
</span></span></code></pre></div><h3 id=terraform-1>Terraform</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#e6db74>&#34;aws_caller_identity&#34; &#34;current&#34;</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role&#34; &#34;vouch_developer&#34;</span> {
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VouchDeveloper&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  assume_role_policy <span style=color:#f92672>=</span> <span style=color:#66d9ef>jsonencode</span>({
</span></span><span style=display:flex><span>    Version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>    Statement <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        Effect <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>        Principal <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>          Federated <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arn:aws:iam::${data.aws_caller_identity.current.account_id}:oidc-provider/us.vouch.sh&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        Action <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sts:AssumeRoleWithWebIdentity&#34;</span>
</span></span><span style=display:flex><span>        Condition <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>          StringEquals <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            &#34;us.vouch.sh:aud&#34; <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;us.vouch.sh&#34;</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role_policy_attachment&#34; &#34;vouch_developer_readonly&#34;</span> {
</span></span><span style=display:flex><span>  role       <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_iam_role</span>.<span style=color:#66d9ef>vouch_developer</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>  policy_arn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;arn:aws:iam::aws:policy/ReadOnlyAccess&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=tips-for-restricting-access>Tips for restricting access</h2><h3 id=restrict-by-email-address>Restrict by email address</h3><p>Limit role assumption to specific users by adding an email condition to the trust policy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;Condition&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;StringEquals&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;us.vouch.sh:aud&#34;</span>: <span style=color:#e6db74>&#34;us.vouch.sh&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;us.vouch.sh:sub&#34;</span>: <span style=color:#e6db74>&#34;user@example.com&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=restrict-by-email-domain>Restrict by email domain</h3><p>Allow any user from a specific domain:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;Condition&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;StringEquals&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;us.vouch.sh:aud&#34;</span>: <span style=color:#e6db74>&#34;us.vouch.sh&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;StringLike&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;us.vouch.sh:sub&#34;</span>: <span style=color:#e6db74>&#34;*@example.com&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=session-tags>Session tags</h3><p>Vouch sets the following session tags when assuming a role, which you can use in IAM policies for <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_attribute-based-access-control.html>attribute-based access control (ABAC)</a>:</p><table><thead><tr><th>Tag Key</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td><code>email</code></td><td>The user&rsquo;s verified email</td><td><code>alice@example.com</code></td></tr><tr><td><code>domain</code></td><td>The user&rsquo;s organization domain (from the OIDC <code>hd</code> claim)</td><td><code>example.com</code></td></tr></tbody></table><p>You can reference these tags in IAM policy conditions using <code>aws:PrincipalTag</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Condition&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;StringEquals&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;aws:PrincipalTag/domain&#34;</span>: <span style=color:#e6db74>&#34;example.com&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=step-3----configure-the-vouch-cli>Step 3 &ndash; Configure the Vouch CLI</h2><p>Each developer needs to tell the CLI which IAM role to assume and in which AWS profile to store the credentials. Run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vouch setup aws --role arn:aws:iam::123456789012:role/VouchDeveloper
</span></span></code></pre></div><p>This command accepts the following flags:</p><ul><li><code>--role</code> &ndash; The ARN of the IAM role created in Step 2 (required).</li><li><code>--profile</code> &ndash; The AWS profile name to write credentials to (default: <code>vouch</code>; additional profiles auto-name as <code>vouch-2</code>, <code>vouch-3</code>, etc.).</li></ul><p>The command writes a <code>credential_process</code> entry into <code>~/.aws/config</code> so that the AWS CLI and SDKs automatically call <code>vouch credential aws</code> whenever credentials are needed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[profile vouch]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>credential_process</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>vouch credential aws --role arn:aws:iam::123456789012:role/VouchDeveloper</span>
</span></span></code></pre></div><blockquote><p><strong>Note:</strong> If you need a specific region for this profile, add a <code>region</code> line manually (e.g., <code>region = us-east-1</code>).</p></blockquote><p>After setup, any tool that reads AWS profiles will transparently use Vouch credentials.</p><hr><h2 id=step-4----test>Step 4 &ndash; Test</h2><p>Verify that everything is working:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Make sure you are logged in</span>
</span></span><span style=display:flex><span>vouch login
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check your identity</span>
</span></span><span style=display:flex><span>aws sts get-caller-identity --profile vouch
</span></span></code></pre></div><p>You should see output similar to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;UserId&#34;</span>: <span style=color:#e6db74>&#34;AROA...:alice@example.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Account&#34;</span>: <span style=color:#e6db74>&#34;123456789012&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Arn&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:sts::123456789012:assumed-role/VouchDeveloper/alice@example.com&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Try running a command against a real AWS service:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws s3 ls --profile vouch
</span></span></code></pre></div><hr><h2 id=troubleshooting>Troubleshooting</h2><h3 id=not-authorized-to-perform-stsassumerolewithwebidentity>&ldquo;Not authorized to perform sts:AssumeRoleWithWebIdentity&rdquo;</h3><ul><li>Verify the OIDC provider URL in the IAM trust policy matches <code>https://us.vouch.sh</code> exactly (no trailing slash).</li><li>Confirm the <code>aud</code> condition matches the client ID registered with the OIDC provider.</li></ul><h3 id=token-is-expired>&ldquo;Token is expired&rdquo;</h3><ul><li>Run <code>vouch login</code> again to refresh your session. OIDC tokens are short-lived by design.</li></ul><h3 id=invalid-identity-token>&ldquo;Invalid identity token&rdquo;</h3><ul><li>Ensure the OIDC provider in AWS points to the correct Vouch server URL: <code>https://us.vouch.sh</code>.</li><li>Verify that the Vouch server&rsquo;s JWKS endpoint (<code>https://us.vouch.sh/.well-known/jwks.json</code>) is reachable from the internet (AWS must be able to fetch it).</li></ul><h3 id=credentials-not-appearing-in-the-expected-profile>Credentials not appearing in the expected profile</h3><ul><li>Run <code>vouch setup aws</code> again and verify the profile name.</li><li>Check <code>~/.aws/config</code> for conflicting profile definitions.</li></ul><h3 id=permission-errors-after-assuming-the-role>Permission errors after assuming the role</h3><ul><li>The trust policy controls who can assume the role; the permissions policy controls what they can do. Verify the correct permissions policies are attached to the IAM role.</li></ul></article></div><div class=sidebar-overlay id=sidebar-overlay onclick=closeSidebar()></div><button class=sidebar-toggle onclick=toggleSidebar() aria-label="Toggle sidebar">
<svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<script>function toggleSidebar(){document.getElementById("docs-sidebar").classList.toggle("open"),document.getElementById("sidebar-overlay").classList.toggle("open")}function closeSidebar(){document.getElementById("docs-sidebar").classList.remove("open"),document.getElementById("sidebar-overlay").classList.remove("open")}</script></main><footer class=footer><div class=footer-inner><div class=footer-left><div>&copy; 2026 Smoke Turner, LLC</div><div class=footer-instances>Instances:
<a href=https://us.vouch.sh>US</a>
&#183;
<span class=coming-soon>EU (coming soon)</span>
&#183;
<span class=coming-soon>APAC (coming soon)</span></div></div><div class=footer-links><a href=/about/>About</a>
<a href=/docs/security/>Security</a>
<a href=/privacy/>Privacy</a>
<a href=/terms/>Terms</a>
<a href=https://github.com/vouch-sh/vouch target=_blank rel=noopener>GitHub</a></div></div></footer></body></html>