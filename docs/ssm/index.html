<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Connect to EC2 Instances without SSH Port 22 â€” Vouch â€” Hardware-Backed Developer Credentials</title>
<meta name=description content="Use AWS Systems Manager Session Manager with Vouch credentials to reach EC2 instances without opening SSH ports."><link rel=canonical href=https://vouch.sh/docs/ssm/><meta property="og:title" content="Connect to EC2 Instances without SSH Port 22 â€” Vouch â€” Hardware-Backed Developer Credentials"><meta property="og:description" content="Use AWS Systems Manager Session Manager with Vouch credentials to reach EC2 instances without opening SSH ports."><meta property="og:url" content="https://vouch.sh/docs/ssm/"><meta property="og:site_name" content="Vouch"><meta property="og:type" content="article"><meta property="og:image" content="https://vouch.sh/img/og-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Connect to EC2 Instances without SSH Port 22 â€” Vouch â€” Hardware-Backed Developer Credentials"><meta name=twitter:description content="Use AWS Systems Manager Session Manager with Vouch credentials to reach EC2 instances without opening SSH ports."><meta name=twitter:image content="https://vouch.sh/img/og-image.png"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”‘</text></svg>"><link rel=author href=/humans.txt><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","description":"Open-source credential broker that issues short-lived SSH, AWS, GitHub, and Kubernetes credentials after FIDO2 hardware verification. One YubiKey tap, 8 hours of access.","name":"Vouch","url":"https://vouch.sh/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","logo":"https://vouch.sh/img/og-image.png","name":"Smoke Turner, LLC","sameAs":["https://github.com/vouch-sh/vouch"],"url":"https://smoketurner.com"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"TechArticle","author":{"@type":"Organization","name":"Smoke Turner, LLC"},"description":"Use AWS Systems Manager Session Manager with Vouch credentials to reach EC2 instances without opening SSH ports.","headline":"Connect to EC2 Instances without SSH Port 22","mainEntityOfPage":{"@id":"https://vouch.sh/docs/ssm/","@type":"WebPage"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://vouch.sh/img/og-image.png"},"name":"Smoke Turner, LLC"}}</script><link rel=stylesheet href=https://vouch.sh/css/main.min.696319dec26a9f9526ac8dae8c8e12c4271af4250b998632e1aca67447bb363d.css></head><body><header class=nav><div class=nav-inner><a href=/ class=nav-logo><svg viewBox="0 0 32 32" fill="none"><rect x="9" y="14" width="14" height="12" rx="2" stroke="currentcolor" stroke-width="2"/><path d="M12 14V10a4 4 0 118 0v4" stroke="currentcolor" stroke-width="2" stroke-linecap="round"/><circle cx="16" cy="20" r="1.5" fill="currentcolor"/><line x1="16" y1="21.5" x2="16" y2="23.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/></svg>
vouch
</a><button class=nav-toggle aria-label="Toggle navigation" onclick='document.querySelector(".nav-links").classList.toggle("open")'><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><ul class=nav-links><li><a href=/docs/>Docs</a></li><li><a href=/blog/>Blog</a></li><li><a href=/about/>About</a></li><li><a href=https://github.com/vouch-sh/vouch target=_blank rel=noopener>GitHub<svg class="github-icon" viewBox="0 0 24 24" fill="currentcolor"><path d="M12 0C5.37.0.0 5.37.0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57.0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925.0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18.0.0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225.0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22.0 1.605-.015 2.895-.015 3.3.0.315.225.69.825.57A12.02 12.02.0 0024 12c0-6.63-5.37-12-12-12z"/></svg></a></li></ul></div></header><main class=content-wrapper><div class=docs-layout><aside class=docs-sidebar id=docs-sidebar><div class=docs-sidebar-title>Documentation</div><nav><ul><li><a href=https://vouch.sh/docs/getting-started/>Getting Started</a></li><li><a href=https://vouch.sh/docs/startups/>Startups</a></li><li class=sidebar-section-group><span class=sidebar-section-label>Infrastructure</span><ul><li><a href=https://vouch.sh/docs/aws/>AWS</a></li><li><a href=https://vouch.sh/docs/aws-multi-account/>AWS Multi-Account</a></li><li><a href=https://vouch.sh/docs/ssh/>SSH Certificates</a></li><li><a href=https://vouch.sh/docs/eks/>Amazon EKS</a></li><li><a href=https://vouch.sh/docs/ssm/ class=active>AWS Systems Manager</a></li><li><a href=https://vouch.sh/docs/databases/>Databases</a></li><li><a href=https://vouch.sh/docs/bedrock/>Amazon Bedrock</a></li></ul></li><li class=sidebar-section-group><span class=sidebar-section-label>Code & Packages</span><ul><li><a href=https://vouch.sh/docs/github/>GitHub</a></li><li><a href=https://vouch.sh/docs/docker/>Docker Registries</a></li><li><a href=https://vouch.sh/docs/codeartifact/>AWS CodeArtifact</a></li><li><a href=https://vouch.sh/docs/codecommit/>AWS CodeCommit</a></li><li><a href=https://vouch.sh/docs/cargo/>Cargo</a></li></ul></li><li class=sidebar-section-group><span class=sidebar-section-label>Platform</span><ul><li class=sidebar-group><div class=sidebar-group-header><a href=https://vouch.sh/docs/applications/>Applications (OIDC)
</a><button class=sidebar-chevron onclick='this.closest(".sidebar-group").classList.toggle("open")' aria-label="Toggle section"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></button></div><ul class=sidebar-children><li><a href=https://vouch.sh/docs/applications/rails/>Rails (OmniAuth)</a></li><li><a href=https://vouch.sh/docs/applications/django/>Django (django-allauth)</a></li><li><a href=https://vouch.sh/docs/applications/express/>Express.js (Passport)</a></li><li><a href=https://vouch.sh/docs/applications/nextjs/>Next.js (NextAuth.js)</a></li><li><a href=https://vouch.sh/docs/applications/laravel/>Laravel (Socialite)</a></li><li><a href=https://vouch.sh/docs/applications/flask/>Flask (Authlib)</a></li><li><a href=https://vouch.sh/docs/applications/fastapi/>FastAPI (Authlib)</a></li><li><a href=https://vouch.sh/docs/applications/spring-boot/>Spring Boot (Spring Security)</a></li><li><a href=https://vouch.sh/docs/applications/axum/>Axum (openidconnect-rs)</a></li><li><a href=https://vouch.sh/docs/applications/react/>React (react-oidc-context)</a></li><li><a href=https://vouch.sh/docs/applications/vue/>Vue (oidc-client-ts)</a></li><li><a href=https://vouch.sh/docs/applications/vanilla-js/>Vanilla JavaScript</a></li><li><a href=https://vouch.sh/docs/applications/device-authorization/>Device Authorization (CLI)</a></li></ul></li><li><a href=https://vouch.sh/docs/scim/>SCIM Provisioning</a></li><li><a href=https://vouch.sh/docs/iac/>Infrastructure as Code</a></li><li><a href=https://vouch.sh/docs/cicd/>CI/CD</a></li><li><a href=https://vouch.sh/docs/cli-reference/>CLI Reference</a></li><li><a href=https://vouch.sh/docs/security/>Security</a></li><li><a href=https://vouch.sh/docs/threat-model/>Threat Model</a></li><li><a href=https://vouch.sh/docs/architecture/>Architecture</a></li><li><a href=https://vouch.sh/docs/availability/>Availability</a></li><li><a href=https://vouch.sh/docs/migration/>Migration</a></li><li><a href=https://vouch.sh/docs/faq/>FAQ</a></li></ul></li></ul></nav></aside><article class=docs-content><div class=docs-breadcrumb><a href=https://vouch.sh/docs/>Docs</a><span class=separator>/</span>
Connect to EC2 Instances without SSH Port 22</div><h1>Connect to EC2 Instances without SSH Port 22</h1><p style=color:var(--text-muted);font-size:1.1rem;margin-bottom:2rem>Connect to EC2 instances through AWS Systems Manager</p><p>Managing SSH access to EC2 instances typically means opening port 22, distributing keys, and maintaining security groups. Every open port is an attack surface, and every key is a secret to manage.</p><p>AWS Systems Manager Session Manager eliminates all of this: connections go through the Systems Manager service, every session is logged in CloudTrail, and no inbound ports are required. With Vouch, the underlying AWS credentials are hardware-verified and short-lived &ndash; after <code>vouch login</code>, you can start sessions to any SSM-managed instance.</p><h2 id=how-it-works>How it works</h2><ol><li><strong><code>vouch login</code></strong> &ndash; The developer authenticates with their YubiKey and receives an OIDC ID token.</li><li><strong><code>credential_process</code></strong> &ndash; The AWS CLI calls Vouch to exchange the OIDC token for temporary STS credentials.</li><li><strong><code>aws ssm start-session</code></strong> &ndash; The AWS CLI uses the STS credentials to start an AWS SSM Session Manager session with the target instance.</li><li><strong>CloudTrail</strong> &ndash; Every session start is recorded with the Vouch user&rsquo;s identity via STS session tags.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>vouch login â†’ credential_process â†’ STS â†’ AWS SSM start-session â†’ CloudTrail
</span></span></code></pre></div><hr><h2 id=prerequisites>Prerequisites</h2><p>Before using AWS Systems Manager Session Manager with Vouch, ensure you have:</p><ul><li>The <strong>Vouch CLI</strong> installed and enrolled (see <a href=/docs/getting-started/>Getting Started</a>)</li><li>The <strong><a href=/docs/aws/>AWS integration</a></strong> configured (OIDC provider and IAM role)</li><li>The <strong><a href=https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html>Session Manager plugin</a></strong> installed for the AWS CLI</li><li>EC2 instances with the <strong>AWS SSM Agent</strong> installed and an instance profile that allows AWS SSM connections</li></ul><hr><h2 id=step-1----start-a-session>Step 1 &ndash; Start a session</h2><p>With an active Vouch session, connect to an instance:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws ssm start-session <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --target i-0abc123def456 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --profile vouch
</span></span></code></pre></div><p>This opens an interactive shell session on the target instance without SSH.</p><hr><h2 id=step-2----ssh-over-aws-ssm>Step 2 &ndash; SSH over AWS SSM</h2><p>You can also use AWS SSM as a transport for standard SSH connections. This lets you use familiar SSH tooling (scp, rsync, port forwarding) while routing traffic through AWS SSM instead of direct TCP connections.</p><h3 id=automated-setup-recommended>Automated setup (recommended)</h3><p>The <code>vouch setup ssm</code> command configures your SSH client automatically:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vouch setup ssm
</span></span></code></pre></div><table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td><code>--profile</code></td><td>AWS profile to use (defaults to auto-detected vouch profile)</td></tr><tr><td><code>--region</code></td><td>AWS region to use in the ProxyCommand</td></tr><tr><td><code>--hosts</code></td><td>Host patterns to match (default: <code>i-* mi-*</code>)</td></tr><tr><td><code>--force</code></td><td>Overwrite any existing SSM configuration in <code>~/.ssh/config</code></td></tr></tbody></table><p>To specify a profile and region explicitly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vouch setup ssm --profile vouch --region us-east-1
</span></span></code></pre></div><p>This adds the following to your <code>~/.ssh/config</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Host i-* mi-*
</span></span><span style=display:flex><span>    ProxyCommand sh -c &#34;aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters &#39;portNumber=%p&#39; --profile vouch --region us-east-1&#34;
</span></span></code></pre></div><h3 id=manual-setup>Manual setup</h3><p>Alternatively, add the following to your <code>~/.ssh/config</code> manually:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Host i-* mi-*
</span></span><span style=display:flex><span>    ProxyCommand sh -c &#34;aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters &#39;portNumber=%p&#39; --profile vouch --region &lt;YOUR_REGION&gt;&#34;
</span></span></code></pre></div><p>Replace <code>&lt;YOUR_REGION></code> with your AWS region (e.g., <code>us-east-1</code>).</p><h3 id=connect>Connect</h3><p>With either setup method, connect with SSH as usual:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh i-0abc123def456
</span></span></code></pre></div><p>Because Vouch configures the SSH agent with a certificate, the SSH session is authenticated with both your Vouch SSH certificate and your hardware-backed AWS credentials.</p><hr><h2 id=port-forwarding>Port forwarding</h2><p>AWS SSM supports port forwarding to access services on private instances. This is useful for reaching databases (such as RDS) through a bastion instance without exposing them to the internet:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Forward local port 5432 to an RDS instance through an EC2 bastion</span>
</span></span><span style=display:flex><span>aws ssm start-session <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --target i-0abc123def456 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --document-name AWS-StartPortForwardingSessionToRemoteHost <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --parameters <span style=color:#e6db74>&#39;{&#34;host&#34;:[&#34;mydb.cluster-abc123.us-east-1.rds.amazonaws.com&#34;],&#34;portNumber&#34;:[&#34;5432&#34;],&#34;localPortNumber&#34;:[&#34;5432&#34;]}&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --profile vouch
</span></span></code></pre></div><p>Then connect to <code>localhost:5432</code> with your database client.</p><hr><h2 id=iam-permissions>IAM permissions</h2><p>The IAM role assumed by Vouch needs AWS SSM session permissions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ssm:StartSession&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ssm:TerminateSession&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ssm:ResumeSession&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;arn:aws:ec2:us-east-1:123456789012:instance/*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;arn:aws:ssm:us-east-1::document/AWS-StartSSHSession&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;arn:aws:ssm:us-east-1::document/AWS-StartPortForwardingSessionToRemoteHost&#34;</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You can restrict access to specific instances using resource ARNs or tag-based conditions.</p><hr><h2 id=session-identity-and-audit>Session identity and audit</h2><p>When Vouch exchanges an OIDC token for STS credentials, the user&rsquo;s email and domain are embedded as session tags. These appear in CloudTrail under <code>userIdentity.sessionContext.webIdFederationData</code>, providing a clear chain from YubiKey tap to AWS SSM session.</p><p>AWS SSM also records session activity. With <a href=https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-logging.html>Session Manager logging</a> enabled, you get a complete record of commands executed during each session.</p><hr><h2 id=troubleshooting>Troubleshooting</h2><h3 id=sessionmanagerplugin-is-not-found>&ldquo;SessionManagerPlugin is not found&rdquo;</h3><p>The Session Manager plugin is not installed or not in your PATH. Install it from the <a href=https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html>AWS documentation</a>.</p><h3 id=targetnotconnected>&ldquo;TargetNotConnected&rdquo;</h3><p>The target instance does not have a running AWS SSM agent or cannot reach the AWS Systems Manager endpoint. Verify:</p><ul><li>The instance has an IAM instance profile with <code>AmazonSSMManagedInstanceCore</code> permissions.</li><li>The AWS SSM agent is running: <code>sudo systemctl status amazon-ssm-agent</code>.</li><li>The instance can reach the AWS SSM endpoint (either through a NAT gateway or VPC endpoint).</li></ul><h3 id=access-denied-when-starting-a-session>&ldquo;Access denied&rdquo; when starting a session</h3><ul><li>Verify your IAM role has <code>ssm:StartSession</code> permission for the target instance.</li><li>Check that the instance ARN matches the resource constraints in your IAM policy.</li><li>Ensure you have an active Vouch session: <code>vouch login</code>.</li></ul><h3 id=vouch-setup-ssm-reports-existing-ssm-configuration><code>vouch setup ssm</code> reports existing SSM configuration</h3><p>If the command detects an existing SSM block in your <code>~/.ssh/config</code>, it will not overwrite it by default. Use the <code>--force</code> flag to replace the existing configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vouch setup ssm --force
</span></span></code></pre></div><h3 id=vouch-doctor-reports-ssm-issues><code>vouch doctor</code> reports SSM issues</h3><p>Run <code>vouch doctor</code> to diagnose SSM configuration problems. If issues are found, run <code>vouch setup ssm</code> to reconfigure your SSH client automatically.</p></article></div><div class=sidebar-overlay id=sidebar-overlay onclick=closeSidebar()></div><button class=sidebar-toggle onclick=toggleSidebar() aria-label="Toggle sidebar">
<svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<script>function toggleSidebar(){document.getElementById("docs-sidebar").classList.toggle("open"),document.getElementById("sidebar-overlay").classList.toggle("open")}function closeSidebar(){document.getElementById("docs-sidebar").classList.remove("open"),document.getElementById("sidebar-overlay").classList.remove("open")}</script></main><footer class=footer><div class=footer-inner><div class=footer-left><div>&copy; 2026 Smoke Turner, LLC</div><div class=footer-instances>Instances:
<a href=https://us.vouch.sh>US</a>
&#183;
<span class=coming-soon>EU (coming soon)</span>
&#183;
<span class=coming-soon>APAC (coming soon)</span></div></div><div class=footer-links><a href=/about/>About</a>
<a href=/docs/security/>Security</a>
<a href=/privacy/>Privacy</a>
<a href=/terms/>Terms</a>
<a href=https://github.com/vouch-sh/vouch target=_blank rel=noopener>GitHub</a></div></div></footer></body></html>