{{ define "main" }}
<div class="docs-layout">
  <aside class="docs-sidebar" id="docs-sidebar">
    <div class="docs-sidebar-title">Documentation</div>
    <nav>
      {{ partial "docs-sidebar-nav.html" . }}
    </nav>
  </aside>

  <article class="docs-content">
    <h1>{{ .Title }}</h1>
    {{ .Content }}

    {{ $docsSection := .Site.GetPage "/docs" }}

    {{/* Featured: Getting Started */}}
    {{ range where $docsSection.Pages.ByWeight ".Params.docsGroup" "featured" }}
    <div style="margin-top: 2rem;">
      <a href="{{ .Permalink }}" class="card card-featured" style="text-decoration: none; color: var(--text); display: block;">
        <h3>{{ .LinkTitle }}</h3>
        {{ with .Description }}<p>{{ . }}</p>{{ end }}
      </a>
    </div>
    {{ end }}

    {{/* Infrastructure group */}}
    {{ $infraPages := where $docsSection.Pages.ByWeight ".Params.docsGroup" "infra" }}
    {{ with $infraPages }}
    <div class="docs-group">
      <h2 class="docs-group-title">Stop rotating access keys and managing credentials</h2>
      <p class="docs-group-description">Access AWS, servers, databases, and AI services with short-lived, hardware-backed tokens.</p>
      <div class="card-grid" style="margin-top: 1.25rem;">
        {{ range . }}
          <a href="{{ .Permalink }}" class="card" style="text-decoration: none; color: var(--text);">
            <h3>{{ .LinkTitle }}</h3>
            {{ with .Description }}<p>{{ . }}</p>{{ end }}
          </a>
        {{ end }}
      </div>
    </div>
    {{ end }}

    {{/* Code group */}}
    {{ $codePages := where $docsSection.Pages.ByWeight ".Params.docsGroup" "code" }}
    {{ with $codePages }}
    <div class="docs-group">
      <h2 class="docs-group-title">Ship code without token juggling</h2>
      <p class="docs-group-description">Authenticate to GitHub, container registries, and package managers with a single YubiKey tap.</p>
      <div class="card-grid" style="margin-top: 1.25rem;">
        {{ range . }}
          <a href="{{ .Permalink }}" class="card" style="text-decoration: none; color: var(--text);">
            <h3>{{ .LinkTitle }}</h3>
            {{ with .Description }}<p>{{ . }}</p>{{ end }}
          </a>
        {{ end }}
      </div>
    </div>
    {{ end }}

    {{/* Manage group */}}
    {{ $managePages := where $docsSection.Pages.ByWeight ".Params.docsGroup" "manage" }}
    {{ with $managePages }}
    <div class="docs-group">
      <h2 class="docs-group-title">Integrate Vouch into your workflow</h2>
      <p class="docs-group-description">Add hardware-verified identity to CI/CD pipelines, IaC tools, your own apps, and user provisioning.</p>
      <div class="card-grid" style="margin-top: 1.25rem;">
        {{ range . }}
          <a href="{{ .Permalink }}" class="card" style="text-decoration: none; color: var(--text);">
            <h3>{{ .LinkTitle }}</h3>
            {{ with .Description }}<p>{{ . }}</p>{{ end }}
          </a>
        {{ end }}
      </div>
    </div>
    {{ end }}

    {{/* Catch-all for ungrouped pages */}}
    {{ $grouped := slice "featured" "infra" "code" "manage" }}
    {{ $ungrouped := where $docsSection.Pages.ByWeight ".Params.docsGroup" "not in" $grouped }}
    {{/* Also include pages with no docsGroup set */}}
    {{ $noGroup := where $docsSection.Pages.ByWeight ".Params.docsGroup" "eq" nil }}
    {{ $allUngrouped := $ungrouped | append $noGroup }}
    {{ with $allUngrouped }}
    <div class="docs-group">
      <h2 class="docs-group-title">More</h2>
      <div class="card-grid" style="margin-top: 1.25rem;">
        {{ range . }}
          <a href="{{ .Permalink }}" class="card" style="text-decoration: none; color: var(--text);">
            <h3>{{ .LinkTitle }}</h3>
            {{ with .Description }}<p>{{ . }}</p>{{ end }}
          </a>
        {{ end }}
      </div>
    </div>
    {{ end }}
  </article>
</div>

<div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
<button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <line x1="3" y1="6" x2="21" y2="6"/>
    <line x1="3" y1="12" x2="21" y2="12"/>
    <line x1="3" y1="18" x2="21" y2="18"/>
  </svg>
</button>

<script>
function toggleSidebar() {
  document.getElementById('docs-sidebar').classList.toggle('open');
  document.getElementById('sidebar-overlay').classList.toggle('open');
}
function closeSidebar() {
  document.getElementById('docs-sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('open');
}
</script>
{{ end }}
