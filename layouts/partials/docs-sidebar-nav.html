{{ $currentPage := . }}
{{ $docsSection := .Site.GetPage "/docs" }}
{{ $allPages := $docsSection.Pages.ByWeight }}
<ul>
  {{/* Render featured pages first (no group header) */}}
  {{ range $allPages }}
    {{ if and (not .IsSection) (eq (default "" .Params.docsGroup) "featured") }}
      <li>
        <a href="{{ .Permalink }}" {{ if eq .Permalink $currentPage.Permalink }}class="active"{{ end }}>
          {{ .LinkTitle }}
        </a>
      </li>
    {{ end }}
  {{ end }}

  {{/* Render each sidebar group */}}
  {{ range $group := site.Params.sidebarGroups }}
    <li class="sidebar-section-group">
      <span class="sidebar-section-label">{{ $group.label }}</span>
      <ul>
        {{ range $allPages }}
          {{ if .IsSection }}
            {{ if eq (default "" .Params.docsGroup) $group.key }}
              {{/* Collapsible section group (e.g., Applications) */}}
              {{ $isAncestor := $currentPage.IsDescendant . }}
              {{ $isActive := eq $currentPage.Permalink .Permalink }}
              <li class="sidebar-group{{ if or $isAncestor $isActive }} open{{ end }}">
                <div class="sidebar-group-header">
                  <a href="{{ .Permalink }}" {{ if $isActive }}class="active"{{ end }}>
                    {{ .LinkTitle }}
                  </a>
                  <button class="sidebar-chevron" onclick="this.closest('.sidebar-group').classList.toggle('open')" aria-label="Toggle section">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </button>
                </div>
                <ul class="sidebar-children">
                  {{ range .Pages.ByWeight }}
                  <li>
                    <a href="{{ .Permalink }}" {{ if eq .Permalink $currentPage.Permalink }}class="active"{{ end }}>
                      {{ .LinkTitle }}
                    </a>
                  </li>
                  {{ end }}
                </ul>
              </li>
            {{ end }}
          {{ else }}
            {{ if eq (default "" .Params.docsGroup) $group.key }}
              <li>
                <a href="{{ .Permalink }}" {{ if eq .Permalink $currentPage.Permalink }}class="active"{{ end }}>
                  {{ .LinkTitle }}
                </a>
              </li>
            {{ end }}
          {{ end }}
        {{ end }}
      </ul>
    </li>
  {{ end }}
</ul>
