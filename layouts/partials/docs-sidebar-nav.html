{{ $currentPage := . }}
{{ $docsSection := .Site.GetPage "/docs" }}
<ul>
  {{ range $docsSection.Pages.ByWeight }}
    {{ if .IsSection }}
      {{/* Collapsible section group (e.g., Applications) */}}
      {{ $isAncestor := $currentPage.IsDescendant . }}
      {{ $isActive := eq $currentPage.Permalink .Permalink }}
      <li class="sidebar-group{{ if or $isAncestor $isActive }} open{{ end }}">
        <div class="sidebar-group-header">
          <a href="{{ .Permalink }}" {{ if $isActive }}class="active"{{ end }}>
            {{ .Title }}
          </a>
          <button class="sidebar-chevron" onclick="this.closest('.sidebar-group').classList.toggle('open')" aria-label="Toggle section">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
        </div>
        <ul class="sidebar-children">
          {{ range .Pages.ByWeight }}
          <li>
            <a href="{{ .Permalink }}" {{ if eq .Permalink $currentPage.Permalink }}class="active"{{ end }}>
              {{ .Title }}
            </a>
          </li>
          {{ end }}
        </ul>
      </li>
    {{ else }}
      {{/* Regular flat page */}}
      <li>
        <a href="{{ .Permalink }}" {{ if eq .Permalink $currentPage.Permalink }}class="active"{{ end }}>
          {{ .Title }}
        </a>
      </li>
    {{ end }}
  {{ end }}
</ul>
